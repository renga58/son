<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Admin Paneli - Han Analiz | FlashOdds Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        // Sayfa √∂nbellekten (geri tu≈üuyla) y√ºklenirse zorla yenile
        window.onpageshow = function(event) {
            if (event.persisted || (window.performance && window.performance.navigation.type === 2)) {
                window.location.reload();
            }
        };
    </script>
    <style>
        .admin-container { max-width: 900px; margin: 50px auto; padding: 20px; }
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 20px; }
        tr { background-color: #313244; }
        td, th { padding: 15px; text-align: left; vertical-align: middle; }
        tr td:first-child { border-top-left-radius: 8px; border-bottom-left-radius: 8px; }
        tr td:last-child { border-top-right-radius: 8px; border-bottom-right-radius: 8px; }
        
        /* Logo Stili */
        .user-logo { 
            width: 40px; height: 40px; 
            border-radius: 50%; 
            object-fit: cover; /* Resmi ezmeden sƒ±ƒüdƒ±r */
            border: 2px solid #fab387; 
            background-color: #1e1e2e;
        }
        
        .btn { padding: 5px 10px; border-radius: 4px; cursor: pointer; border: none; font-weight: bold; margin-right: 5px; }
        .btn-edit { background: #89b4fa; color: #1e1e2e; }
        .btn-delete { background: #f38ba8; color: #1e1e2e; }
        .btn-add { background: #a6e3a1; color: #1e1e2e; padding: 10px 20px; font-size: 16px; margin-bottom: 20px; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: #1e1e2e; margin: 5% auto; padding: 25px; width: 400px; border-radius: 12px; border: 1px solid #45475a; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; color: #bac2de; margin-bottom: 5px; font-size: 14px; }
        .form-group input { width: 100%; padding: 10px; background: #313244; border: 1px solid #585b70; color: white; border-radius: 6px; box-sizing: border-box; }
        .form-group input:focus { border-color: #89b4fa; outline: none; }

        /* √ñnizleme Resmi */
        .preview-img {
            width: 80px; height: 80px; 
            border-radius: 50%; 
            border: 2px solid #a6e3a1; 
            object-fit: cover; 
            display: block; 
            margin: 10px auto;
            background: #11111b;
        }
    </style>
</head>
<body>
    <div style="
    width: 100%;                  /* Ekranƒ±n tamamƒ±nƒ± kapla */
    box-sizing: border-box;       /* Padding ta≈ümasƒ± yapmasƒ±n */
    display: flex; 
    justify-content: space-between; /* Biri en sola, biri en saƒüa */
    align-items: center; 
    padding: 20px 40px;           /* Kenarlardan bo≈üluk */
    background-color: #1e1e2e; 
    border-bottom: 2px solid #45475a; 
    margin-bottom: 30px;
    position: relative;           /* Konumlandƒ±rmayƒ± saƒülama al */
    ">
    
    <a href="/analyze" style="
        background-color: #89b4fa; 
        color: #1e1e2e; 
        padding: 12px 25px; 
        border-radius: 8px; 
        text-decoration: none; 
        font-weight: bold;
        font-size: 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: 0.2s;">
        ‚¨ÖÔ∏è Analize D√∂n
    </a>

    <a href="/logout" style="
        background-color: #f38ba8; 
        color: #1e1e2e; 
        padding: 12px 25px; 
        border-radius: 8px; 
        text-decoration: none; 
        font-weight: bold;
        font-size: 16px;
        border: 2px solid #eba0ac;
        transition: 0.2s;">
        √áƒ±kƒ±≈ü Yap üö™
    </a>
</div>
    <div class="admin-container">
        <h1>üëë Admin Paneli: Kullanƒ±cƒ± Y√∂netimi</h1>
        
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div style="padding:12px; margin-bottom:15px; border-radius:6px; background: {{ '#a6e3a1' if category=='success' else '#f38ba8' }}; color:#1e1e2e; font-weight:bold;">
                  {{ message }}
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <button class="btn btn-add" onclick="openAddModal()">+ Yeni Kullanƒ±cƒ± Ekle</button>

        <table>
            <thead>
                <tr>
                    <th>Logo</th>
                    <th>Kullanƒ±cƒ± Adƒ±</th>
                    <th>Rol</th>
                    <th>ƒ∞≈ülemler</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <td>
                        <img src="{{ user[3] }}" class="user-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'">
                    </td>
                    <td style="font-weight:bold; color:white;">{{ user[1] }}</td>
                    <td style="color:#fab387;">{{ user[2] }}</td>
                    <td>
                        <button class="btn btn-edit" onclick="openEditModal({{ user[0] }}, '{{ user[1] }}', '{{ user[3] }}')">D√ºzenle</button>
                        {% if user[2] != 'admin' %}
                        <a href="/admin/delete_user/{{ user[0] }}" class="btn btn-delete" onclick="return confirm('Silmek istediƒüine emin misin?')">Sil</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <h2 style="color:#a6e3a1; text-align:center;">Yeni Kullanƒ±cƒ±</h2>
            
            <img id="preview_add" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="preview-img">
            
            <form action="/admin/add_user" method="POST">
                <div class="form-group">
                    <label>Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" name="username" required>
                </div>
                <div class="form-group">
                    <label>≈ûifre</label>
                    <input type="text" name="password" required>
                </div>
                <div class="form-group">
                    <label>Logo URL (Yapƒ±≈ütƒ±rƒ±nca yukarƒ±da g√∂r√ºn√ºr)</label>
                    <input type="text" name="logo" id="input_logo_add" placeholder="https://..." oninput="updatePreview('input_logo_add', 'preview_add')">
                </div>
                <button type="submit" class="btn btn-add" style="width:100%;">Kaydet</button>
                <button type="button" onclick="closeModal('addModal')" style="background:none; border:none; color:#bac2de; width:100%; cursor:pointer; margin-top:10px;">ƒ∞ptal</button>
            </form>
        </div>
    </div>

    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2 style="color:#89b4fa; text-align:center;">Kullanƒ±cƒ± D√ºzenle</h2>

            <img id="preview_edit" src="" class="preview-img" onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'">

            <form action="/admin/edit_user" method="POST">
                <input type="hidden" name="user_id" id="edit_id">
                <div class="form-group">
                    <label>Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" name="username" id="edit_username" required>
                </div>
                <div class="form-group">
                    <label>Yeni ≈ûifre (Deƒüi≈ümeyecekse bo≈ü bƒ±rak)</label>
                    <input type="text" name="password" placeholder="*****">
                </div>
                <div class="form-group">
                    <label>Logo URL</label>
                    <input type="text" name="logo" id="edit_logo" oninput="updatePreview('edit_logo', 'preview_edit')">
                </div>
                <button type="submit" class="btn btn-edit" style="width:100%;">G√ºncelle</button>
                <button type="button" onclick="closeModal('editModal')" style="background:none; border:none; color:#bac2de; width:100%; cursor:pointer; margin-top:10px;">ƒ∞ptal</button>
            </form>
        </div>
    </div>

    <script>
        // √ñnizleme Fonksiyonu
        function updatePreview(inputId, imgId) {
            const url = document.getElementById(inputId).value;
            const img = document.getElementById(imgId);
            if(url) {
                img.src = url;
            } else {
                img.src = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
            }
        }

        function openAddModal() { 
            document.getElementById('addModal').style.display = 'block'; 
            document.getElementById('input_logo_add').value = "";
            document.getElementById('preview_add').src = "https://cdn-icons-png.flaticon.com/512/149/149071.png";
        }

        function openEditModal(id, username, logo) {
            document.getElementById('edit_id').value = id;
            document.getElementById('edit_username').value = username;
            document.getElementById('edit_logo').value = logo;
            
            // Logoyu √∂nizlemeye y√ºkle
            const preview = document.getElementById('preview_edit');
            if(logo) preview.src = logo;
            else preview.src = "https://cdn-icons-png.flaticon.com/512/149/149071.png";

            document.getElementById('editModal').style.display = 'block';
        }

        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
        
        window.onclick = function(event) {
            if (event.target.className === 'modal') {
                event.target.style.display = "none";
            }
        }
    </script>
</body>
</html>